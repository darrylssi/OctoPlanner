<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">

<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <title>Users</title>

    <link rel="stylesheet" th:href=@{/styles/main.css}>
    <link rel="stylesheet" th:href=@{/styles/users.css}>
    <script th:src="@{/scripts/editRoles.js}"></script>

</head>

<body>
<div th:replace="fragments :: header(title='Users')"></div>
<br>
<div class="users" >
    <table>
        <thead>
        <tr>
            <th> <a th:href="@{'/users/?page=' + ${page} + '&orderBy=name&asc=' + ${reverseDir}}"> Name
                <span th:if="${orderBy == 'name'}"> <span th:text="${dir} ? '▼' : '▲'" /> </span> </a> </th>
            <th> <a th:href="@{'/users/?page=' + ${page} + '&orderBy=username&asc=' + ${reverseDir}}"> Username
                <span th:if="${orderBy == 'username'}"> <span th:text="${dir} ? '▼' : '▲'" /> </span> </a> </th>
            <th> <a th:href="@{'/users/?page=' + ${page} + '&orderBy=nickname&asc=' + ${reverseDir}}"> Alias
                <span th:if="${orderBy == 'nickname'}"> <span th:text="${dir} ? '▼' : '▲'" /> </span> </a> </th>
            <th> <a th:href="@{'/users/?page=' + ${page} + '&orderBy=role&asc=' + ${reverseDir}}"> Role
                <span th:if="${orderBy == 'role'}"> <span th:text="${dir} ? '▼' : '▲'" /> </span> </a> </th>
        </tr>
        </thead>
        <tbody>
        <tr th:if="${users.empty}">
            <td colspan="2"> No users found </td>
        </tr>
        <tr th:each="user : ${users}">
            <td><span th:text="${user.getFirstName() +' '+ user.getMiddleName() + ' ' + user.getLastName()}"> Name </span></td>
            <td><span th:text="${user.getUsername()}"> Username </span></td>
            <td><span th:text="${user.getNickname()}"> Alias </span></td>
            <td style="display: flex; justify-content: space-between"><span style="display:none" th:text="${user.getRolesList()}"> Roles </span>
                <div class="roles-list">
                <div class="role" th:each="role: ${user.getRolesList()}">
                    <div th:text="${role}"></div>
                    <button th:if="${user.getRolesList().size() > 1}" class="remove-role-button" th:data-parameter1="${user.getId()}" th:data-parameter2="${role}" th:onclick="removeRole(this.getAttribute('data-parameter1'),this.getAttribute('data-parameter2'))">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-x" viewBox="0 0 16 16">
                            <path d="M4.646 4.646a.5.5 0 0 1 .708 0L8 7.293l2.646-2.647a.5.5 0 0 1 .708.708L8.707 8l2.647 2.646a.5.5 0 0 1-.708.708L8 8.707l-2.646 2.647a.5.5 0 0 1-.708-.708L7.293 8 4.646 5.354a.5.5 0 0 1 0-.708z"/>
                        </svg>
                    </button>
                </div>
                </div>
                <button class="add-role-button" th:data-parameter="${user.getId()}" th:onclick="addRole(this.getAttribute('data-parameter'), 'COURSE_ADMINISTRATOR')">
                    <svg xmlns="http://www.w3.org/2000/svg" width="25" height="25" fill="currentColor" class="bi bi-plus" viewBox="0 0 16 16">
                        <path d="M8 4a.5.5 0 0 1 .5.5v3h3a.5.5 0 0 1 0 1h-3v3a.5.5 0 0 1-1 0v-3h-3a.5.5 0 0 1 0-1h3v-3A.5.5 0 0 1 8 4z"/>
                    </svg></button>
            </td>
        </tr>
        </tbody>
    </table>
    <br>
    <div class="pagination" th:if="${totalPages > 1}">
<!--        if not on first page, add link to first page -->
        <span class="pages otherPages" th:if="${page > 1}">
            <a th:href="@{'/users/?page=1&orderBy=' + ${orderBy} + '&asc=' + ${dir}}"> First </a>
        </span>
<!--        add link to PREV page -->
        <span class="pages otherPages" th:if="${page > 1}">
            <a th:href="@{'/users/?page=' + ${page - 1} + '&orderBy=' + ${orderBy} + '&asc=' + ${dir}}"> Prev </a>
        </span>
<!--        add link to all pages -->
        <th:block th:if="${totalPages <= 2}">
            <span class="pages" th:each="i: ${#numbers.sequence(1, totalPages)}">
                <a th:href="@{'/users/?page=' + ${i} + '&orderBy='+ ${orderBy} +'&asc=' + ${dir}}" th:if="${i != page}"
                   class="otherPages">[[${i}]]</a>
                <span th:unless="${i != page}" class="currentPage">[[${i}]]</span>
            </span>
        </th:block>
        <th:block th:if="${totalPages > 2}">
            <th:block th:if="${page <= 2 || page >= totalPages - 2}">
                <span class="pages" th:each="i: ${#numbers.sequence(1, 2)}">
                    <a th:href="@{'/users/?page=' + ${i} + '&orderBy='+ ${orderBy} +'&asc=' + ${dir}}" th:if="${i != page}"
                       class="otherPages">[[${i}]]</a>
                    <span th:unless="${i != page}" class="currentPage">[[${i}]]</span>
                </span>

                <a th:href="@{'/users/?page=' + 3 + '&orderBy='+ ${orderBy} +'&asc=' + ${dir}}" class="otherPages">...</a>

                <span class="pages" th:each="i: ${#numbers.sequence(totalPages - 2, totalPages)}">
                    <a th:href="@{'/users/?page=' + ${i} + '&orderBy='+ ${orderBy} +'&asc=' + ${dir}}" th:if="${i != page}"
                       class="otherPages">[[${i}]]</a>
                    <span th:unless="${i != page}" class="currentPage">[[${i}]]</span>
                </span>
            </th:block>

            <th:block th:if="${page > 2 && page < totalPages - 2}">
                <a th:href="@{'/users/?page=' + ${page - 2} + '&orderBy='+ ${orderBy} +'&asc=' + ${dir}}" class="otherPages">...</a>

                <span class="pages" th:each="i: ${#numbers.sequence(page - 2, page + 2)}">
                    <a th:href="@{'/users/?page=' + ${i} + '&orderBy='+ ${orderBy} +'&asc=' + ${dir}}" th:if="${i != page}"
                       class="otherPages">[[${i}]]</a>
                    <span th:unless="${i != page}" class="currentPage">[[${i}]]</span>
                </span>

                <a th:href="@{'/users/?page=' + ${page + 2} + '&orderBy='+ ${orderBy} +'&asc=' + ${dir}}" class="otherPages">...</a>
            </th:block>
        </th:block>

<!--        add link to NEXT page -->
        <span class="pages otherPages" th:if="${page < totalPages}">
            <a th:href="@{'/users/?page=' + ${page + 1} + '&orderBy=' + ${orderBy} + '&asc=' + ${dir}}"> Next </a>
        </span>
<!--        add link to LAST page-->
        <span class="pages otherPages" th:if="${page < totalPages}">
            <a th:href="@{'/users/?page=' + ${totalPages} + '&orderBy=' + ${orderBy} + '&asc=' + ${dir}}"> Last </a>
        </span>
    </div>

</div>


</body>

</html>
